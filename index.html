<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historical World Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/timeline.css">
    <link rel="stylesheet" href="css/info-panel.css">
    <link rel="stylesheet" href="css/leaderboard.css">
    <link rel="stylesheet" href="css/graph-panel.css">
    <link rel="stylesheet" href="css/settings-panel.css">
</head>
<body>
    <div id="loading" class="loading">
        <h2>Loading Historical Data...</h2>
        <p id="loading-polities">Loading polities...</p>
        <p id="loading-cities">Loading cities...</p>
    </div>

    <div id="map"></div>

    <div id="info-panel" class="info-panel">
        <div class="info-panel-header">
            <h3 id="info-name"></h3>
            <div class="info-panel-actions">
                <button class="info-panel-btn" id="info-copy" title="Copy for AI query">
                    <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                        <rect x="5" y="5" width="9" height="9" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
                        <rect x="2" y="2" width="9" height="9" rx="1" fill="none" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                </button>
                <a class="info-panel-btn info-wiki-btn" id="info-wiki" title="View on Wikipedia" target="_blank" style="display: none;">
                    Wiki <span class="wiki-arrow">↗</span>
                </a>
                <button class="info-panel-btn info-panel-close" id="info-close" title="Close">&times;</button>
            </div>
        </div>
        <div id="info-subtitle" class="info-panel-subtitle"></div>
        <div id="info-content"></div>
    </div>

    <div id="graph-panel" class="graph-panel">
        <!-- Resize handles -->
        <div class="graph-resize-handle nw" data-resize="nw"></div>
        <div class="graph-resize-handle ne" data-resize="ne"></div>
        <div class="graph-resize-handle sw" data-resize="sw"></div>
        <div class="graph-resize-handle se" data-resize="se"></div>
        <div class="graph-resize-edge n" data-resize="n"></div>
        <div class="graph-resize-edge s" data-resize="s"></div>
        <div class="graph-resize-edge w" data-resize="w"></div>
        <div class="graph-resize-edge e" data-resize="e"></div>

        <div class="graph-header">
            <h4>Historical Trends</h4>
            <button id="graph-close" class="graph-close" title="Close graph">&times;</button>
        </div>
        <div class="metric-tabs">
            <button class="metric-tab active" data-metric="population">Population</button>
            <button class="metric-tab" data-metric="civilizations">Civilizations</button>
            <button class="metric-tab" data-metric="landArea">Land Area</button>
            <button class="metric-tab" data-metric="cities">Cities</button>
            <button class="metric-tab" data-metric="urbanPop">Urban Pop</button>
            <button class="metric-tab" data-metric="gdpPerCapita">GDP/capita</button>
            <button class="metric-tab" data-metric="largestEmpire">Largest Empire</button>
            <button class="metric-tab" data-metric="avgAge">Avg Civ Age</button>
        </div>
        <div class="graph-content">
            <div class="graph-current">
                <span id="graph-value" class="graph-value">—</span>
                <span id="graph-delta" class="graph-delta neutral">—</span>
            </div>
            <div class="graph-canvas-container">
                <canvas id="graph-canvas"></canvas>
            </div>
            <div class="graph-range">
                <span id="graph-range-start">—</span>
                <span id="graph-range-end">—</span>
            </div>
            <div id="graph-label" class="graph-label">World Population (millions)</div>
        </div>
        <div class="graph-window-control">
            <div class="window-mode-toggle">
                <button class="window-mode-btn active" data-mode="flexible" title="Independent window position">Flexible</button>
                <button class="window-mode-btn" data-mode="sliding" title="Window follows current year">Sliding</button>
            </div>
            <select id="window-width-select" class="window-width-select" title="Window width">
                <option value="100">100 years</option>
                <option value="200">200 years</option>
                <option value="500">500 years</option>
                <option value="1000">1000 years</option>
                <option value="2000" selected>2000 years</option>
                <option value="5724">Full timeline</option>
            </select>
            <input type="range" id="window-slider" min="-3700" max="24" value="-3400">
            <span id="window-year-display" class="window-year-display">3400 BCE — 1400 BCE</span>
        </div>
    </div>

    <div id="stats-panel" class="stats-panel hidden">
        <div class="stats-panel-header">
            <h4>World Stats</h4>
        </div>
        <div id="stats-panel-content" class="stats-panel-content"></div>
    </div>

    <div id="leaderboard" class="leaderboard">
        <div class="leaderboard-header">
            <h4>Leaderboard</h4>
            <button class="filter-btn" id="filter-btn" title="Filter">
                <svg width="14" height="12" viewBox="0 0 14 12" fill="currentColor">
                    <rect x="0" y="0" width="14" height="2" rx="1"/>
                    <rect x="2" y="5" width="10" height="2" rx="1"/>
                    <rect x="4" y="10" width="6" height="2" rx="1"/>
                </svg>
                <span>Filter</span>
            </button>
        </div>
        <div id="leaderboard-filters" class="leaderboard-filters hidden">
            <button class="filter-option active" data-sort="all">All</button>
            <button class="filter-option" data-sort="area">Area</button>
            <button class="filter-option" data-sort="cities">Cities</button>
            <button class="filter-option" data-sort="age">Age</button>
        </div>
        <div id="leaderboard-content" class="leaderboard-content">
            <div class="leaderboard-empty">Loading...</div>
        </div>
    </div>

    <!-- Pinned toggles menu - sits above quick menu -->
    <div id="pinned-menu" class="pinned-menu hidden">
        <div class="pinned-toggles" id="pinned-toggles"></div>
    </div>

    <!-- Quick menu - vertical buttons above timeline -->
    <div id="quick-menu" class="quick-menu">
        <button class="quick-menu-btn" id="qm-stats" title="Toggle Stats">
            <svg class="qm-icon" viewBox="0 0 20 20" fill="currentColor">
                <rect x="2" y="10" width="4" height="8" rx="1"/>
                <rect x="8" y="6" width="4" height="12" rx="1"/>
                <rect x="14" y="2" width="4" height="16" rx="1"/>
            </svg>
            <span class="qm-label">Stats</span>
        </button>
        <button class="quick-menu-btn active" id="qm-leaderboard" title="Toggle Leaderboard">
            <svg class="qm-icon" viewBox="0 0 20 20" fill="currentColor">
                <path d="M10 2l2.5 5 5.5.8-4 3.9.9 5.3-4.9-2.6-4.9 2.6.9-5.3-4-3.9 5.5-.8z"/>
            </svg>
            <span class="qm-label">Ranks</span>
        </button>
        <button class="quick-menu-btn" id="qm-graph" title="Toggle Graph">
            <svg class="qm-icon" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="1.5">
                <polyline points="2,16 6,10 10,13 14,6 18,8"/>
                <circle cx="6" cy="10" r="1.5" fill="currentColor"/>
                <circle cx="10" cy="13" r="1.5" fill="currentColor"/>
                <circle cx="14" cy="6" r="1.5" fill="currentColor"/>
            </svg>
            <span class="qm-label">Graph</span>
        </button>
        <button class="quick-menu-btn" id="qm-expand" title="Collapse menu">
            <svg class="qm-icon" viewBox="0 0 20 20" fill="none">
                <path d="M8 5l5 5-5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>

    <div class="controls-wrapper" id="controls-wrapper">
        <div class="controls-tab">
            <div class="controls-tab-left">
                <div class="panel-tabs">
                    <button class="panel-tab" data-panel="disputes">
                        <span class="tab-icon disputes-icon">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2c0 4-4 6-4 10a4 4 0 0 0 8 0c0-4-4-6-4-10z"/>
                                <path d="M12 12c0 2-1.5 3-1.5 4.5a1.5 1.5 0 0 0 3 0c0-1.5-1.5-2.5-1.5-4.5z" fill="currentColor" stroke="none"/>
                            </svg>
                        </span>
                        <span class="tab-label">Disputes</span>
                    </button>
                    <button class="panel-tab" data-panel="view">
                        <span class="tab-terrain-preview"></span>
                        <span class="tab-label">View</span>
                    </button>
                </div>
            </div>
            <div class="controls-tab-right">
                <button class="panel-tab active" data-panel="timeline">
                    <span id="year-display-mini">1 CE</span>
                    <span class="tab-label">Timeline</span>
                </button>
                <div class="playback-controls-mini">
                    <button class="playback-btn-mini" id="year-minus-1" title="Back 1 year">−1</button>
                    <button class="playback-btn-mini play-pause-mini" id="play-btn-mini" title="Play/Pause">
                        <span class="play-icon-mini">▶</span>
                        <span class="pause-icon-mini" style="display:none;">❚❚</span>
                    </button>
                    <button class="playback-btn-mini" id="year-plus-1" title="Forward 1 year">+1</button>
                </div>
                <button class="panel-tab settings-tab" data-panel="settings" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="controls-panels">
            <div class="controls-panel active" id="timeline-panel">
            <div class="timeline-container">
                <div id="year-display">1 CE</div>
                <button class="timeline-nav-btn" id="timeline-nav-left" title="Pan left" disabled>
                    <span>&#9664;</span>
                </button>
                <div class="timeline-wrapper">
                    <div class="timeline-ruler" id="timeline-ruler"></div>
                    <input type="range" id="timeline" min="-3700" max="2024" value="1">
                    <div id="timeline-ticks" class="timeline-ticks"></div>
                </div>
                <button class="timeline-nav-btn" id="timeline-nav-right" title="Pan right" disabled>
                    <span>&#9654;</span>
                </button>
            </div>
            <div class="timeline-controls">
                <div class="year-input-group">
                    <input type="number" id="year-input" value="1" min="1" max="3700" title="Enter year">
                    <select id="era-select" class="era-select" title="Select era">
                        <option value="bce">BCE</option>
                        <option value="ce" selected>CE</option>
                    </select>
                    <button class="step-btn" id="go-to-year" title="Go to year">Go</button>
                </div>
                <div class="step-group">
                    <button class="step-btn" data-step="-100" title="-100 years">-100</button>
                    <button class="step-btn" data-step="-50" title="-50 years">-50</button>
                    <button class="step-btn" data-step="-25" title="-25 years">-25</button>
                    <button class="step-btn" data-step="-10" title="-10 years">-10</button>
                    <button class="step-btn" data-step="-1" title="-1 year">-1</button>
                </div>
                <div class="playback-group">
                    <button class="play-btn" id="play-btn" title="Play/Pause">
                        <span class="play-icon">&#9658;</span>
                        <span class="pause-icon" style="display:none;">&#10074;&#10074;</span>
                    </button>
                    <select id="playback-speed" class="speed-select" title="Playback speed">
                        <option value="4000">0.25 yr/s</option>
                        <option value="2000">0.5 yr/s</option>
                        <option value="1000">1 yr/s</option>
                        <option value="400">2.5 yr/s</option>
                        <option value="200">5 yr/s</option>
                        <option value="100">10 yr/s</option>
                        <option value="33" selected>30 yr/s</option>
                        <option value="16">60 yr/s</option>
                        <option value="10">100 yr/s</option>
                        <option value="5">200 yr/s</option>
                    </select>
                </div>
                <div class="step-group">
                    <button class="step-btn" data-step="1" title="+1 year">+1</button>
                    <button class="step-btn" data-step="10" title="+10 years">+10</button>
                    <button class="step-btn" data-step="25" title="+25 years">+25</button>
                    <button class="step-btn" data-step="50" title="+50 years">+50</button>
                    <button class="step-btn" data-step="100" title="+100 years">+100</button>
                </div>
                <div class="timeline-zoom-controls">
                    <button class="zoom-btn" id="zoom-out" title="Zoom out" disabled>−</button>
                    <span class="zoom-level" id="zoom-level">Full</span>
                    <button class="zoom-btn" id="zoom-in" title="Zoom in">+</button>
                </div>
            </div>
            <!-- Hidden elements for compatibility -->
            <span style="display:none;">Polities: <strong id="polity-count">0</strong></span>
            <span style="display:none;">Cities: <strong id="city-count">0</strong></span>
            <span style="display:none;">Pop: <strong id="total-population">0</strong></span>
            </div>
            <div class="controls-panel" id="disputes-panel">
                <div class="disputes-content">
                    <h3 class="disputes-title">Historical Disputes Heatmap</h3>
                    <p class="disputes-desc">Visualize territorial contestation and settlement patterns across history.</p>
                    <div class="disputes-options">
                        <button class="dispute-card active" data-heatmap="off">
                            <div class="dispute-card-preview off">
                                <span class="off-icon">○</span>
                            </div>
                            <div class="dispute-card-label">Off</div>
                        </button>
                        <button class="dispute-card" data-heatmap="contested">
                            <div class="dispute-card-preview contested"></div>
                            <div class="dispute-card-label">Most Contested</div>
                            <div class="dispute-card-desc">Areas with frequent territorial changes</div>
                        </button>
                        <button class="dispute-card" data-heatmap="settled">
                            <div class="dispute-card-preview settled"></div>
                            <div class="dispute-card-label">Most Settled</div>
                            <div class="dispute-card-desc">Areas with long-term stable control</div>
                        </button>
                    </div>
                    <div class="heatmap-status" id="heatmap-status"></div>
                </div>
            </div>
            <div class="controls-panel" id="view-panel">
                <div class="ribbon-content">
                    <!-- Base Map - Land Only -->
                    <div class="ribbon-section ribbon-section-basemap">
                        <div class="ribbon-section-title">Land</div>
                        <div class="basemap-grid-compact">
                            <button class="basemap-chip" data-basemap="dark" title="Dark">
                                <span class="chip-preview" style="background: linear-gradient(135deg, #1a1a2e, #2d2d44);"></span>
                                <span class="chip-label">Dark</span>
                            </button>
                            <button class="basemap-chip" data-basemap="light" title="Light">
                                <span class="chip-preview" style="background: linear-gradient(135deg, #e8e8e8, #f5f5f5);"></span>
                                <span class="chip-label">Light</span>
                            </button>
                            <button class="basemap-chip active" data-basemap="satellite" title="Satellite">
                                <span class="chip-preview" style="background: linear-gradient(135deg, #1a3d1a, #2d5a3d);"></span>
                                <span class="chip-label">Sat</span>
                            </button>
                            <button class="basemap-chip" data-basemap="physical" title="Physical">
                                <span class="chip-preview" style="background: linear-gradient(135deg, #c9d9a0, #8eb078);"></span>
                                <span class="chip-label">Phys</span>
                            </button>
                            <button class="basemap-chip" data-basemap="terrain" title="Terrain">
                                <span class="chip-preview" style="background: linear-gradient(135deg, #d4e4bc, #e8dcc8);"></span>
                                <span class="chip-label">Terr</span>
                            </button>
                            <button class="basemap-chip" data-basemap="toner" title="Toner">
                                <span class="chip-preview" style="background: linear-gradient(135deg, #fff, #888);"></span>
                                <span class="chip-label">Tone</span>
                            </button>
                            <button class="basemap-chip" data-basemap="topo" title="Topo">
                                <span class="chip-preview" style="background: linear-gradient(135deg, #f2efe9, #c9b896);"></span>
                                <span class="chip-label">Topo</span>
                            </button>
                            <button class="basemap-chip" data-basemap="black" title="Black">
                                <span class="chip-preview" style="background: #000;"></span>
                                <span class="chip-label">Blk</span>
                            </button>
                        </div>
                    </div>

                    <div class="ribbon-divider"></div>

                    <!-- Territories Section -->
                    <div class="ribbon-section" id="territories-controls">
                        <div class="ribbon-section-title">Territories</div>
                        <div class="ribbon-toggle-row">
                            <button id="toggle-territories" class="ribbon-toggle active">On</button>
                            <button class="pin-btn" data-toggle="territories" title="Pin to quick access">
                                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M8 1v6M5 7h6l-1 5H6l-1-5zM6 12v3M10 12v3"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ribbon-controls">
                            <select id="territory-palette" title="Color palette">
                                <option value="default" selected>Default</option>
                                <option value="mixed1">Mixed I</option>
                                <option value="mixed2">Mixed II</option>
                                <option value="warm">Warm</option>
                                <option value="cool">Cool</option>
                                <option value="vivid">Vivid</option>
                                <option value="earth">Earth</option>
                            </select>
                        </div>
                        <div class="ribbon-sub-toggle">
                            <span class="ribbon-sub-label">MODERN LABELS</span>
                            <button id="toggle-labels" class="ribbon-toggle">Off</button>
                        </div>
                    </div>

                    <div class="ribbon-divider"></div>

                    <!-- Elevation Section -->
                    <div class="ribbon-section" id="elevation-controls">
                        <div class="ribbon-section-title">Elevation</div>
                        <div class="ribbon-toggle-row">
                            <button id="toggle-elevation" class="ribbon-toggle active">On</button>
                            <button class="pin-btn" data-toggle="elevation" title="Pin to quick access">
                                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M8 1v6M5 7h6l-1 5H6l-1-5zM6 12v3M10 12v3"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ribbon-controls">
                            <select id="terrain-max-height" title="Max height">
                                <option value="1500">1.5km</option>
                                <option value="2500">2.5km</option>
                                <option value="3500" selected>3.5km</option>
                                <option value="5000">5km</option>
                                <option value="8848">8.8km</option>
                            </select>
                            <div class="ribbon-slider-group">
                                <label>Op</label>
                                <input type="range" id="terrain-opacity-slider" min="0" max="100" value="50">
                            </div>
                            <div class="ribbon-slider-group">
                                <label>Int</label>
                                <input type="range" id="terrain-intensity-slider" min="0" max="200" value="200">
                            </div>
                        </div>
                        <div class="gradient-picker" id="elevation-gradient-picker">
                            <div class="gradient-selected" data-preset="terrain" style="background: linear-gradient(90deg, #1a472a, #8b7355, #fff);" title="Click to change"></div>
                            <div class="gradient-dropdown">
                                <div class="gradient-option active" data-preset="terrain" style="background: linear-gradient(90deg, #1a472a, #8b7355, #fff);">
                                    <span class="gradient-label">Terrain</span>
                                </div>
                                <div class="gradient-option" data-preset="heat" style="background: linear-gradient(90deg, #000080, #ffd700, #fff);">
                                    <span class="gradient-label">Heat</span>
                                </div>
                                <div class="gradient-option" data-preset="earth" style="background: linear-gradient(90deg, #228b22, #daa520, #fff);">
                                    <span class="gradient-label">Earth</span>
                                </div>
                                <div class="gradient-option" data-preset="mono" style="background: linear-gradient(90deg, #1a1a2e, #8a8aaa, #fff);">
                                    <span class="gradient-label">Mono</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="ribbon-divider"></div>

                    <!-- Rivers Section -->
                    <div class="ribbon-section" id="rivers-controls">
                        <div class="ribbon-section-title">Rivers</div>
                        <div class="ribbon-toggle-row">
                            <button id="toggle-rivers" class="ribbon-toggle active">On</button>
                            <button class="pin-btn" data-toggle="rivers" title="Pin to quick access">
                                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M8 1v6M5 7h6l-1 5H6l-1-5zM6 12v3M10 12v3"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ribbon-controls">
                            <select id="river-detail" title="Detail level">
                                <option value="2">Large</option>
                                <option value="4">Med</option>
                                <option value="6" selected>Small</option>
                                <option value="8">Stream</option>
                            </select>
                            <select id="river-style" title="Style">
                                <option value="intense">Intense</option>
                                <option value="strong" selected>Strong</option>
                                <option value="normal">Normal</option>
                                <option value="subtle">Subtle</option>
                            </select>
                        </div>
                    </div>

                    <div class="ribbon-divider"></div>

                    <!-- Coastlines Section -->
                    <div class="ribbon-section" id="coastlines-controls">
                        <div class="ribbon-section-title">Coasts</div>
                        <div class="ribbon-toggle-row">
                            <button id="toggle-coastlines" class="ribbon-toggle active">On</button>
                            <button class="pin-btn" data-toggle="coastlines" title="Pin to quick access">
                                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M8 1v6M5 7h6l-1 5H6l-1-5zM6 12v3M10 12v3"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ribbon-controls">
                            <select id="coastline-detail" title="Detail">
                                <option value="detailed" selected>High</option>
                                <option value="standard">Std</option>
                            </select>
                            <select id="coastline-style" title="Style">
                                <option value="strong" selected>Strong</option>
                                <option value="normal">Normal</option>
                                <option value="subtle">Subtle</option>
                            </select>
                        </div>
                    </div>

                    <div class="ribbon-divider"></div>

                    <!-- Oceans Section -->
                    <div class="ribbon-section" id="oceans-controls">
                        <div class="ribbon-section-title">Oceans</div>
                        <div class="ribbon-toggle-row">
                            <button id="toggle-oceans" class="ribbon-toggle">Off</button>
                            <button class="pin-btn" data-toggle="oceans" title="Pin to quick access">
                                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M8 1v6M5 7h6l-1 5H6l-1-5zM6 12v3M10 12v3"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ribbon-controls">
                            <select id="ocean-opacity" title="Opacity - use 100% to fully replace base map oceans">
                                <option value="0.4">40%</option>
                                <option value="0.6">60%</option>
                                <option value="0.8">80%</option>
                                <option value="1.0" selected>100%</option>
                            </select>
                            <select id="ocean-palette" title="Color palette">
                                <option value="blue" selected>Blue</option>
                                <option value="deep">Deep</option>
                                <option value="teal">Teal</option>
                                <option value="navy">Navy</option>
                                <option value="arctic">Arctic</option>
                                <option value="warm">Warm</option>
                                <option value="mono">Mono</option>
                            </select>
                        </div>
                    </div>

                    <div class="ribbon-divider"></div>

                    <!-- Civ Names Section -->
                    <div class="ribbon-section" id="civ-names-controls">
                        <div class="ribbon-section-title">Civ Names</div>
                        <div class="ribbon-toggle-row">
                            <button id="toggle-civ-names" class="ribbon-toggle">Off</button>
                            <button class="pin-btn" data-toggle="civ-names" title="Pin to quick access">
                                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M8 1v6M5 7h6l-1 5H6l-1-5zM6 12v3M10 12v3"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ribbon-controls">
                            <select id="label-density" title="Density">
                                <option value="crowded">All</option>
                                <option value="balanced" selected>Some</option>
                                <option value="major">Major</option>
                            </select>
                            <select id="label-subtlety" title="Subtlety">
                                <option value="bold">Bold</option>
                                <option value="normal">Normal</option>
                                <option value="subtle" selected>Subtle</option>
                            </select>
                            <select id="label-case" title="Case">
                                <option value="uppercase" selected>CAPS</option>
                                <option value="capitalize">Title</option>
                                <option value="none">Normal</option>
                            </select>
                        </div>
                    </div>

                    <div class="ribbon-divider"></div>

                    <!-- Cities Section -->
                    <div class="ribbon-section" id="cities-controls">
                        <div class="ribbon-section-title">Cities</div>
                        <div class="ribbon-toggle-row">
                            <button id="toggle-cities" class="ribbon-toggle active">On</button>
                            <button class="pin-btn" data-toggle="cities" title="Pin to quick access">
                                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M8 1v6M5 7h6l-1 5H6l-1-5zM6 12v3M10 12v3"/>
                                </svg>
                            </button>
                        </div>
                        <div class="ribbon-controls">
                            <select id="city-lightness" title="Lightness">
                                <option value="normal">Normal</option>
                                <option value="light">Light</option>
                                <option value="pale" selected>Pale</option>
                            </select>
                            <select id="city-outline" title="Outline">
                                <option value="none">None</option>
                                <option value="thin">Thin</option>
                                <option value="normal" selected>Normal</option>
                                <option value="bold">Bold</option>
                            </select>
                        </div>
                    </div>

                    <!-- Hidden elements for compatibility -->
                    <input type="hidden" id="label-position" value="visual">
                    <input type="hidden" id="label-contrast" value="medium">
                    <input type="hidden" id="river-hover" value="on">
                    <input type="hidden" id="river-sensitivity" value="standard">
                    <input type="hidden" id="city-hover" value="on">
                    <input type="hidden" id="city-sensitivity" value="standard">
                    <input type="hidden" id="city-outline-color" value="light">
                    <input type="hidden" id="ocean-fill" value="on">
                    <input type="hidden" id="ocean-line-weight" value="1">
                    <input type="hidden" id="ocean-line-color" value="#0a2840">
                    <input type="hidden" id="ocean-tooltips" value="on">
                </div>
            </div>
            <div class="controls-panel" id="settings-panel">
                <div class="settings-content">
                    <!-- Theme Section -->
                    <div class="view-section">
                        <div class="view-section-title">Theme</div>
                        <div class="theme-grid">
                            <button class="theme-option active" data-theme="light-modern">
                                <div class="theme-preview theme-preview-light"></div>
                                <span class="theme-name">Light Modern</span>
                            </button>
                            <button class="theme-option" data-theme="dark-modern">
                                <div class="theme-preview theme-preview-dark"></div>
                                <span class="theme-name">Dark Modern</span>
                            </button>
                            <button class="theme-option" data-theme="neutral-modern">
                                <div class="theme-preview theme-preview-neutral"></div>
                                <span class="theme-name">Neutral</span>
                            </button>
                            <button class="theme-option" data-theme="offwhite-modern">
                                <div class="theme-preview theme-preview-offwhite"></div>
                                <span class="theme-name">Offwhite</span>
                            </button>
                        </div>
                    </div>
                    <!-- Crosshair Section -->
                    <div class="view-section">
                        <div class="view-section-title">Crosshair</div>
                        <div class="crosshair-grid">
                            <button class="crosshair-option active" data-crosshair="cross" title="Cross">
                                <div class="crosshair-preview">
                                    <svg width="20" height="20" viewBox="0 0 20 20">
                                        <line x1="10" y1="2" x2="10" y2="18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        <line x1="2" y1="10" x2="18" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </div>
                                <span class="crosshair-name">Cross</span>
                            </button>
                            <button class="crosshair-option" data-crosshair="crossThin" title="Thin Cross">
                                <div class="crosshair-preview">
                                    <svg width="16" height="16" viewBox="0 0 16 16">
                                        <line x1="8" y1="1" x2="8" y2="15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        <line x1="1" y1="8" x2="15" y2="8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                </div>
                                <span class="crosshair-name">Thin</span>
                            </button>
                            <button class="crosshair-option" data-crosshair="circle" title="Circle">
                                <div class="crosshair-preview">
                                    <svg width="14" height="14" viewBox="0 0 14 14">
                                        <circle cx="7" cy="7" r="5" fill="currentColor" opacity="0.4" stroke="currentColor" stroke-width="1.5"/>
                                    </svg>
                                </div>
                                <span class="crosshair-name">Circle</span>
                            </button>
                            <button class="crosshair-option" data-crosshair="circleHollow" title="Hollow Circle">
                                <div class="crosshair-preview">
                                    <svg width="16" height="16" viewBox="0 0 16 16">
                                        <circle cx="8" cy="8" r="6" fill="none" stroke="currentColor" stroke-width="2"/>
                                    </svg>
                                </div>
                                <span class="crosshair-name">Ring</span>
                            </button>
                            <button class="crosshair-option" data-crosshair="dot" title="Dot">
                                <div class="crosshair-preview">
                                    <svg width="10" height="10" viewBox="0 0 10 10">
                                        <circle cx="5" cy="5" r="4" fill="currentColor"/>
                                    </svg>
                                </div>
                                <span class="crosshair-name">Dot</span>
                            </button>
                            <button class="crosshair-option" data-crosshair="target" title="Target">
                                <div class="crosshair-preview">
                                    <svg width="20" height="20" viewBox="0 0 20 20">
                                        <circle cx="10" cy="10" r="8" fill="none" stroke="currentColor" stroke-width="1.5"/>
                                        <circle cx="10" cy="10" r="3" fill="currentColor"/>
                                    </svg>
                                </div>
                                <span class="crosshair-name">Target</span>
                            </button>
                        </div>
                    </div>
                    <!-- Layout Section -->
                    <div class="view-section">
                        <div class="view-section-title">Layout</div>
                        <div class="layout-options">
                            <div class="layout-row">
                                <span class="layout-label">Controls position</span>
                                <div class="layout-switch-group">
                                    <button class="layout-switch-btn active" data-position="bottom">Bottom</button>
                                    <button class="layout-switch-btn" data-position="top">Top</button>
                                </div>
                            </div>
                            <div class="layout-row">
                                <span class="layout-label">Edge offset (Arc)</span>
                                <div class="layout-switch-group">
                                    <button class="layout-switch-btn active" data-offset="normal">Normal</button>
                                    <button class="layout-switch-btn" data-offset="further">Further</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>
